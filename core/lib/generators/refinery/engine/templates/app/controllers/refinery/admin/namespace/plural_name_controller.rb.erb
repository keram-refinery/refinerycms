module Refinery
  module Admin
    module <%= namespacing %>
      class <%= class_name.pluralize %>Controller < ::Refinery::AdminController

        crudify :'refinery/<%= namespacing.underscore %>/<%= singular_name %>'<% if plural_name == singular_name %>,
                redirect_to_url: :refinery_admin_<%= namespacing.underscore %>_<%= singular_name %>_index_path<% end %>

      private

        def <%= singular_name %>_params
          params.require(:<%= singular_name %>).permit(<%= [].tap do |a|
            attributes.each.each do |attribute|
              if [:image, :resource].include?(attribute.type)
                a << ":#{attribute.name}_id".gsub("_id_id", "_id")
              else
                a << ":#{attribute.name}"
              end
            end
          end.join(', ') -%>)
        end

      end
    end
  end
end
