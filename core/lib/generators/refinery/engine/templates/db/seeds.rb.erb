require 'refinery/user'
require 'refinery/page'

plugin = Refinery::Plugins['<%= extension_name -%>']
if plugin
  Refinery::User.all.each do |user|
    if user.plugins.where(name: plugin.name).blank?
      user.plugins.create(name: plugin.name,
                          position: (user.plugins.maximum(:position) || -1) +1)
    end
  end

<% unless skip_frontend? -%>
  if plugin.page.nil?
    pages = {
      <%= class_name.underscore -%>: {
        title: '<%= class_name.pluralize.underscore.titleize %>',
        deletable: false,
        status: 'live',
        plugin_page_id: plugin.name
      }
    }

    Refinery::Pages::Import.new(plugin, pages, false).run
  end
<% end %>
end
