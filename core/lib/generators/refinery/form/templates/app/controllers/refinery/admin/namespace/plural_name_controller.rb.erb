module Refinery
  module Admin
    module <%= namespacing %>
      class <%= class_name.pluralize %>Controller < Refinery::AdminController

        crudify :'refinery/<%= namespacing.underscore %>/<%= singular_name %>',
                order: 'id ASC'

        def index
          @<%= plural_name %> = find_all_<%= plural_name %><% if includes_spam? -%>.ham<% end -%>

          @grouped_<%= plural_name %> = group_by_date(@<%= plural_name %>)
        end

<% if includes_spam? -%>
        def spam
          @<%= plural_name %> = find_all_<%= plural_name %>.spam

          @grouped_<%= plural_name %> = group_by_date(@<%= plural_name %>)
        end

        def toggle_spam
          find_<%= singular_name %>
          @<%= singular_name %>.toggle!(:spam)

          redirect_to :back
        end
<% end -%>
      end
    end
  end
end
