module Refinery
  module Admin
    module <%= namespacing %>
      class <%= class_name.pluralize %>Controller < Refinery::AdminController

        crudify :'refinery/<%= namespacing.underscore %>/<%= singular_name %>',
                order: 'id ASC'

<% if includes_spam? -%>
        before_action :get_spam_count, only: [:index, :spam]

        def index
          @<%= plural_name %> = find_all_<%= plural_name %>.ham

          @grouped_<%= plural_name %> = group_by_date(@<%= plural_name %>)
        end

        def spam
          @<%= plural_name %> = find_all_<%= plural_name %>.spam

          @grouped_<%= plural_name %> = group_by_date(@<%= plural_name %>)
        end

        def toggle_spam
          find_<%= singular_name %>
          @<%= singular_name %>.toggle!(:spam)

          redirect_to :back
        end

      protected

        def get_spam_count
          @spam_count = <%= class_name %>.count(conditions: {spam: true})
        end
<% else %>
        def index
           find_all_<%= plural_name %>

          @grouped_<%= plural_name %> = group_by_date(@<%= plural_name %>)
        end

<% end -%>
      end
    end
  end
end
